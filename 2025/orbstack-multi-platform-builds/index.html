<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />


<title>Enabling Multi-Platform Docker Builds with OrbStack | Simon Neutert</title>

<meta name="description" content="I am a Ruby (on Rails) developer and open source enthusiast. Super interest in Clojure. Based in Ingelheim, next to Mainz and Wiesbaden (Rhein-Main)." />

<link rel="stylesheet" href="/_bridgetown/static/index.POPT2NFP.css" data-turbo-track="reload" />

<script src="/_bridgetown/static/index.Q4PHQU7R.js" data-turbo-track="reload" defer></script>


    <link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Simon Neutert" />
  </head>
  <body class="post ">
    <header>
  <!-- 
  <img src="/images/logo.svg" alt="Logo" />
  -->
</header>

<nav>
  <ul>
    <li><a href="/">Home</a></li>
    <!-- <li><a href="/telegram">On Telegram</a></li> -->
    <!-- <li><a href="/about">About</a></li> -->
    <li><a href="/posts">Blog</a></li>
  </ul>
</nav>


    <main>
      <a href="/posts" style="text-decoration:none; text-align=center;">‚ÜñÔ∏è Show all posts</a>

<hr />

<h1>Enabling Multi-Platform Docker Builds with OrbStack</h1>

<p>OrbStack is a fast, lightweight alternative to Docker Desktop for macOS. One of its powerful features is the ability to build Docker images for multiple architectures (like ARM64 and AMD64) using Docker Buildx. This is essential when you‚Äôre developing on Apple Silicon but need to deploy to x86_64 servers or support multiple platforms.</p>

<h2 id="why-multi-platform-builds-matter">Why Multi-Platform Builds Matter</h2>

<p>With the rise of ARM-based systems (Apple Silicon, AWS Graviton, Raspberry Pi), building images that work across architectures has become crucial. Multi-platform builds allow you to:</p>

<ul>
  <li>Develop on Apple Silicon Macs and deploy to x86_64 servers</li>
  <li>Create images that work on both ARM and AMD architectures</li>
  <li>Support diverse deployment environments without maintaining separate build pipelines</li>
  <li>Ensure your application works consistently across different hardware</li>
</ul>

<h2 id="prerequisites">Prerequisites</h2>

<p>First, make sure you have OrbStack installed on your Mac. You can download it from <a href="https://orbstack.dev">orbstack.dev</a> or install it via Homebrew:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>orbstack
</code></pre></div></div>

<p>Once installed, OrbStack will manage your Docker daemon and provide enhanced performance compared to Docker Desktop.</p>

<h2 id="setting-up-docker-buildx">Setting Up Docker Buildx</h2>

<p>Docker Buildx is Docker‚Äôs CLI plugin for extended build capabilities with full BuildKit support. OrbStack has excellent support for Buildx, but you need to set up a builder instance to enable multi-platform builds.</p>

<h3 id="create-a-new-builder-instance">Create a New Builder Instance</h3>

<p>The key command to enable multi-platform builds is:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker buildx create <span class="nt">--name</span> builder <span class="nt">--driver</span> docker-container <span class="nt">--use</span>
</code></pre></div></div>

<p>Let‚Äôs break down what this command does:</p>

<ul>
  <li><code class="highlighter-rouge">docker buildx create</code> - Creates a new builder instance</li>
  <li><code class="highlighter-rouge">--name builder</code> - Names the builder instance ‚Äúbuilder‚Äù (you can use any name you prefer)</li>
  <li><code class="highlighter-rouge">--driver docker-container</code> - Uses the docker-container driver, which runs BuildKit in a container for better isolation and platform support</li>
  <li><code class="highlighter-rouge">--use</code> - Automatically switches to use this new builder as the default</li>
</ul>

<h3 id="verify-your-builder">Verify Your Builder</h3>

<p>After creating the builder, you can inspect it:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker buildx inspect <span class="nt">--bootstrap</span>
</code></pre></div></div>

<p>This command will show you the platforms your builder supports. You should see something like:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Name:   builder
Driver: docker-container

Nodes:
Name:      builder0
Endpoint:  orbstack
Status:    running
Platforms: linux/arm64, linux/amd64, linux/riscv64, linux/ppc64le, linux/s390x, linux/386, linux/arm/v7, linux/arm/v6
</code></pre></div></div>

<p>The <code class="highlighter-rouge">--bootstrap</code> flag ensures the builder container is started if it‚Äôs not already running.</p>

<h2 id="building-multi-platform-images">Building Multi-Platform Images</h2>

<p>Now that your builder is set up, you can build images for multiple platforms.</p>

<h3 id="basic-multi-platform-build">Basic Multi-Platform Build</h3>

<p>Here‚Äôs a simple example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker buildx build <span class="nt">--platform</span> linux/amd64,linux/arm64 <span class="nt">-t</span> myapp:latest <span class="nb">.</span>
</code></pre></div></div>

<p>This builds your image for both AMD64 (x86_64) and ARM64 architectures.</p>

<h3 id="building-and-pushing-to-a-registry">Building and Pushing to a Registry</h3>

<p>To build and push multi-platform images to a container registry:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker buildx build <span class="se">\</span>
  <span class="nt">--platform</span> linux/amd64,linux/arm64 <span class="se">\</span>
  <span class="nt">-t</span> myregistry.com/myapp:latest <span class="se">\</span>
  <span class="nt">--push</span> <span class="se">\</span>
  <span class="nb">.</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">--push</code> flag automatically pushes the images to your registry after building.</p>

<h3 id="loading-images-locally">Loading Images Locally</h3>

<p>If you want to build for multiple platforms and load the image into your local Docker instance (note: this only works for your current architecture):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker buildx build <span class="se">\</span>
  <span class="nt">--platform</span> linux/arm64 <span class="se">\</span>
  <span class="nt">-t</span> myapp:latest <span class="se">\</span>
  <span class="nt">--load</span> <span class="se">\</span>
  <span class="nb">.</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">--load</code> flag loads the image into your local Docker daemon, but it only works with a single platform that matches your current architecture.</p>

<h2 id="-configuring-github-token-for-container-registry">üîê Configuring GitHub Token for Container Registry</h2>

<p>If you‚Äôre planning to push your multi-platform images to GitHub Container Registry (GHCR), you‚Äôll need to configure your GitHub token properly. Here‚Äôs a friendly reminder to set things up correctly!</p>

<h3 id="setting-up-your-gh_token">Setting Up Your GH_TOKEN</h3>

<p>First, create a Personal Access Token (PAT) on GitHub with the following permissions:</p>

<ul>
  <li><code class="highlighter-rouge">write:packages</code> - Upload packages to GitHub Package Registry</li>
  <li><code class="highlighter-rouge">read:packages</code> - Download packages from GitHub Package Registry</li>
  <li><code class="highlighter-rouge">delete:packages</code> - Delete packages from GitHub Package Registry (optional)</li>
  <li><code class="highlighter-rouge">repo</code> - Full control of private repositories (if pushing private images)</li>
</ul>

<p>Then, add it to your <code class="highlighter-rouge">~/.zshrc</code> or <code class="highlighter-rouge">~/.bashrc</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Add this to your ~/.zshrc or ~/.bashrc</span>
<span class="nb">export </span><span class="nv">GH_TOKEN</span><span class="o">=</span><span class="s2">"your_github_personal_access_token_here"</span>
</code></pre></div></div>

<p>Don‚Äôt forget to reload your shell configuration:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source</span> ~/.zshrc  <span class="c"># for zsh</span>
<span class="c"># or</span>
<span class="nb">source</span> ~/.bashrc  <span class="c"># for bash</span>
</code></pre></div></div>

<h3 id="authenticate-with-github">Authenticate with GitHub</h3>

<p>Once your token is configured, refresh your GitHub CLI authentication and log in to the container registry:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Refresh GitHub CLI authentication</span>
gh auth refresh

<span class="c"># Login to GitHub Container Registry</span>
docker login ghcr.io <span class="nt">-u</span> &lt;your-github-username&gt;
</code></pre></div></div>

<p>When prompted for a password, use your <code class="highlighter-rouge">GH_TOKEN</code> value (not your GitHub password).</p>

<p>Alternatively, you can login directly using your token:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="nv">$GH_TOKEN</span> | docker login ghcr.io <span class="nt">-u</span> &lt;your-github-username&gt; <span class="nt">--password-stdin</span>
</code></pre></div></div>

<h3 id="verify-your-authentication">Verify Your Authentication</h3>

<p>Test that everything is configured correctly:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gh auth status
</code></pre></div></div>

<h2 id="managing-builders">Managing Builders</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker buildx <span class="c"># for help with buildx commands</span>
</code></pre></div></div>

<h2 id="wrapping-up">Wrapping Up</h2>

<p>Setting up multi-platform builds with OrbStack is straightforward and powerful. The <code class="highlighter-rouge">docker buildx create --name builder --driver docker-container --use</code> command gives you access to cross-platform building capabilities that are essential in today‚Äôs diverse computing landscape.</p>

<p>With OrbStack‚Äôs excellent performance on Apple Silicon and Docker Buildx‚Äôs multi-platform support, you can develop locally on ARM and confidently deploy to any architecture your production environment requires.</p>

<p>Happy building! üöÄ</p>


<hr />

<a id="btn-previous" href="/2025/to-podman/" style="text-decoration:none;">‚¨ÖÔ∏è Read previous</a>

<a id="btn-next" href="/2025/bbmaid/" style="float: right; text-decoration:none;">Read next ‚û°Ô∏è</a>

    </main>

    <footer>
  <p style="text-align:center"><strong>
    <a href="/feed.xml">Feed</a>
  </strong></p>

  <hr />

  <h6>Imprint</h6>
  <p>
    <strong>Simon Neutert</strong><br />
    <span id="imprint-address">
      Postfach 1120, 55258 Ingelheim
    </span>
  </p>
  <p style="text-align:center"><strong>
    Generated using <a href="https://www.bridgetownrb.com">Bridgetown</a>
  </strong></p>
</footer>

  </body>
</html>
