<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />


<title>Simple Internal DSL with Ruby | Simon Neutert</title>

<meta name="description" content="I am a Ruby (on Rails) developer and open source enthusiast. Super interest in Clojure. Based in Ingelheim, next to Mainz and Wiesbaden (Rhein-Main)." />

<link rel="stylesheet" href="/_bridgetown/static/index.POPT2NFP.css" data-turbo-track="reload" />

<script src="/_bridgetown/static/index.Q4PHQU7R.js" data-turbo-track="reload" defer></script>


    <link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Simon Neutert" />
  </head>
  <body class="post ">
    <header>
  <!-- 
  <img src="/images/logo.svg" alt="Logo" />
  -->
</header>

<nav>
  <ul>
    <li><a href="/">Home</a></li>
    <!-- <li><a href="/telegram">On Telegram</a></li> -->
    <!-- <li><a href="/about">About</a></li> -->
    <li><a href="/posts">Blog</a></li>
  </ul>
</nav>


    <main>
      <a href="/posts" style="text-decoration:none; text-align=center;">↖️ Show all posts</a>

<hr />

<h1>Simple Internal DSL with Ruby</h1>

<p>I may write up or comment out the code in detail in the future. For the curious, here is a very good post from <a href="https://robots.thoughtbot.com/writing-a-domain-specific-language-in-ruby">Gabe Berke-Williams on thoughtbot.com</a>.</p>

<p>To further sharpening your skills, I recommend googling <strong>&#8220;ruby how to use method_missing&#8221;</strong> and <strong>&#8220;instance_eval vs class_eval ruby&#8221;</strong> - those are key in meta programming Ruby.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># to not pollute the global namespace, wrap your DSL in a module and class</span>
<span class="k">module</span> <span class="nn">DslWrapper</span>
    <span class="k">class</span> <span class="nc">Post</span>
        <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
            <span class="vi">@user</span> <span class="o">=</span> <span class="n">user</span>
            <span class="vi">@post</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="vi">@extras</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">end</span>
        <span class="k">def</span> <span class="nf">text</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
            <span class="vi">@post</span> <span class="o">&lt;&lt;</span> <span class="n">str</span>
            <span class="nb">self</span>
        <span class="k">end</span>
        <span class="k">def</span> <span class="nf">hashtag</span><span class="p">(</span><span class="o">*</span><span class="n">strs</span><span class="p">)</span>
            <span class="n">strs</span><span class="p">.</span><span class="nf">each</span> <span class="p">{</span><span class="o">|</span><span class="n">str</span><span class="o">|</span> <span class="vi">@post</span> <span class="o">&lt;&lt;</span> <span class="s1">'#'</span> <span class="o">+</span> <span class="n">str</span><span class="p">}</span>
            <span class="nb">self</span>
        <span class="k">end</span>
        <span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
            <span class="vi">@post</span> <span class="o">&lt;&lt;</span> <span class="n">str</span>
            <span class="nb">self</span>
        <span class="k">end</span>
        <span class="k">def</span> <span class="nf">post_on_facebook</span>
            <span class="n">fb_text</span> <span class="o">=</span> <span class="vi">@post</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>
            <span class="k">begin</span>
                <span class="k">if</span> <span class="n">fb_text</span><span class="p">.</span><span class="nf">length</span> <span class="o">&lt;=</span> <span class="mi">440</span>
                    <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="vi">@user</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">fb_text</span><span class="si">}</span><span class="s2">"</span>
                    <span class="nb">puts</span> <span class="vi">@extras</span><span class="p">.</span><span class="nf">inspect</span> <span class="k">unless</span> <span class="vi">@extras</span><span class="p">.</span><span class="nf">empty?</span>
                <span class="k">else</span>
                    <span class="k">raise</span> <span class="s1">'Your post is too long.'</span>
                <span class="k">end</span>
            <span class="k">rescue</span>
                <span class="nb">puts</span> <span class="s2">"I can't tweet this, your tweet is too long, sorry."</span>
            <span class="k">end</span>
        <span class="k">end</span>
        <span class="k">def</span> <span class="nf">method_missing</span><span class="p">(</span><span class="nb">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
            <span class="vi">@extras</span><span class="p">[</span><span class="nb">method</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s1">', '</span><span class="p">)</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>this is your exposed dsl method</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># your exposed DSL method</span>
<span class="k">def</span> <span class="nf">post_as</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
    <span class="n">post</span> <span class="o">=</span> <span class="no">DslWrapper</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="n">post</span><span class="p">.</span><span class="nf">text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="k">if</span> <span class="n">text</span>
    <span class="c1"># by passing the block to instance_eval your</span>
    <span class="c1"># passed in methods are now run in the scope of Post Class</span>
    <span class="n">post</span><span class="p">.</span><span class="nf">instance_eval</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span> <span class="k">if</span> <span class="nb">block_given?</span>
    <span class="n">post</span><span class="p">.</span><span class="nf">post_on_facebook</span>
<span class="k">end</span>
</code></pre></div></div>

<p>now, let&#8217;s see your DSL in action!</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># granular style</span>
<span class="n">post_as</span> <span class="s1">'Mark_Z'</span> <span class="k">do</span>
    <span class="n">text</span> <span class="s2">"""
            Lorem ipsum dolor sit amet, consectetur adipisicing elit,
            sed do eiusmod tempor incididunt ut labore et dolore magna
                aliqua. Ut enim ad minim veniam, quis nostrud exercitation
                ullamco laboris nisi ut aliquip ex ea commodo consequat.
                Duis aute irure dolor in reprehenderit in voluptate velit
                esse cillum dolore eu fugiat nulla pariatur. Excepteur
                sint occaecat cupidatat non proident, sunt in culpa qui
                officia deserunt mollit anim id est laborum.
        """</span>
    <span class="n">hashtag</span> <span class="s1">'ruby'</span>
    <span class="n">hashtag</span> <span class="s1">'dsl'</span>
    <span class="n">link</span> <span class="s1">'http://www.simon-neutert.de'</span>
    <span class="n">sexy</span> <span class="s1">'objects'</span>
<span class="k">end</span>
<span class="c1"># multiple hashtags in one line</span>
<span class="n">post_as</span> <span class="s1">'Mark_Z'</span> <span class="k">do</span>
    <span class="n">text</span> <span class="s1">'my dsl works'</span>
    <span class="n">hashtag</span> <span class="s1">'ruby'</span><span class="p">,</span> <span class="s1">'dsl'</span>
    <span class="n">link</span> <span class="s1">'http://www.simon-neutert.de'</span>
    <span class="n">sexy</span> <span class="s1">'classy'</span>
<span class="k">end</span>
<span class="c1"># method chaining (possible, because Post's methods return "self")</span>
<span class="n">post_as</span> <span class="s1">'Mark_Z'</span> <span class="k">do</span>
    <span class="n">text</span><span class="p">(</span><span class="s2">"Mic check..."</span><span class="p">).</span><span class="nf">hashtag</span><span class="p">(</span><span class="s2">"one"</span><span class="p">,</span> <span class="s2">"two"</span><span class="p">).</span><span class="nf">link</span><span class="p">(</span><span class="s1">'http://www.simon-neutert.de'</span><span class="p">)</span>
    <span class="n">sexy</span> <span class="s1">'bit'</span>
<span class="k">end</span>
<span class="c1"># in a one liner</span>
<span class="n">post_as</span> <span class="s1">'Mark_Z'</span><span class="p">,</span> <span class="s1">'Hi, I am Mark_Z!'</span>
</code></pre></div></div>


<hr />

<a id="btn-previous" href="/2017/ruby-using-class_eval-in-service-objects/" style="text-decoration:none;">⬅️ Read previous</a>

<a id="btn-next" href="/2017/destructuring-with-ruby/" style="float: right; text-decoration:none;">Read next ➡️</a>

    </main>

    <footer>
  <p style="text-align:center"><strong>
    <a href="/feed.xml">Feed</a>
  </strong></p>

  <hr />

  <h6>Imprint</h6>
  <p>
    <strong>Simon Neutert</strong><br />
    <span id="imprint-address">
      Postfach 1120, 55258 Ingelheim
    </span>
  </p>
  <p style="text-align:center"><strong>
    Generated using <a href="https://www.bridgetownrb.com">Bridgetown</a>
  </strong></p>
</footer>

  </body>
</html>
