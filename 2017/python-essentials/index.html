<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />


<title>Beautiful and idiomatic Python with Raymond Hattinger | Simon Neutert</title>

<meta name="description" content="I am a Ruby (on Rails) developer and open source enthusiast. Super interest in Clojure. Based in Ingelheim, next to Mainz and Wiesbaden (Rhein-Main)." />

<link rel="stylesheet" href="/_bridgetown/static/index.POPT2NFP.css" data-turbo-track="reload" />

<script src="/_bridgetown/static/index.KGKIVIBR.js" data-turbo-track="reload" defer></script>


    <link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Simon Neutert" />
  </head>
  <body class="post ">
    <header>
  <!-- 
  <img src="/images/logo.svg" alt="Logo" />
  -->
</header>

<nav>
  <ul>
    <li><a href="/">Home</a></li>
    <!-- <li><a href="/telegram">On Telegram</a></li> -->
    <!-- <li><a href="/about">About</a></li> -->
    <li><a href="/posts">Blog</a></li>
  </ul>
</nav>


    <main>
      <a href="/posts" style="text-decoration:none; text-align=center;">↖️ Show all posts</a>

<hr />

<h1>Beautiful and idiomatic Python with Raymond Hattinger</h1>

<p>All credits to <a href="https://github.com/JeffPaine/beautiful_idiomatic_python">JeffPaine</a>, who summarized this incredibly useful <a href="https://www.youtube.com/watch?v=OSGv2VnC0go&amp;">talk of the infamous Raymond Hattinger</a>. All of the following content is copied from his <a href="https://github.com/JeffPaine/beautiful_idiomatic_python">public repository on GitHub</a>:</p>

<h1 id="transforming-code-into-beautiful-idiomatic-python">Transforming Code into Beautiful, Idiomatic Python</h1>

<p>Notes from Raymond Hettinger’s talk at pycon US 2013 <a href="https://www.youtube.com/watch?v=OSGv2VnC0go&amp;">video</a>, <a href="https://speakerdeck.com/pyconslides/transforming-code-into-beautiful-idiomatic-python-by-raymond-hettinger-1">slides</a>.</p>

<p>The code examples and direct quotes are all from Raymond’s talk. I’ve reproduced them here for my own edification and the hopes that others will find them as handy as I have!</p>

<h2 id="looping-over-a-range-of-numbers">Looping over a range of numbers</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]:</span>
    <span class="k">print</span> <span class="n">i</span><span class="o">**</span><span class="mi">2</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">i</span><span class="o">**</span><span class="mi">2</span>
</code></pre></div></div>

<h3 id="better">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">xrange</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">i</span><span class="o">**</span><span class="mi">2</span>
</code></pre></div></div>
<p><code class="highlighter-rouge">xrange</code> creates an iterator over the range producing the values one at a time. This approach is much more memory efficient than <code class="highlighter-rouge">range</code>. <code class="highlighter-rouge">xrange</code> was renamed to <code class="highlighter-rouge">range</code> in python 3.</p>

<h2 id="looping-over-a-collection">Looping over a collection</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">green</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">yellow</span><span class="sh">'</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)):</span>
    <span class="k">print</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="better-1">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">color</span>
</code></pre></div></div>

<h2 id="looping-backwards">Looping backwards</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">green</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">yellow</span><span class="sh">'</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="better-2">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="nf">reversed</span><span class="p">(</span><span class="n">colors</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">color</span>
</code></pre></div></div>

<h2 id="looping-over-a-collection-and-indices">Looping over a collection and indices</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">green</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">yellow</span><span class="sh">'</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)):</span>
    <span class="k">print</span> <span class="n">i</span><span class="p">,</span> <span class="sh">'</span><span class="s">---&gt;</span><span class="sh">'</span><span class="p">,</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="better-3">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">colors</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">i</span><span class="p">,</span> <span class="sh">'</span><span class="s">---&gt;</span><span class="sh">'</span><span class="p">,</span> <span class="n">color</span>
</code></pre></div></div>
<blockquote>
  <p>It’s fast and beautiful and saves you from tracking the individual indices and incrementing them.</p>
</blockquote>

<blockquote>
  <p>Whenever you find yourself manipulating indices [in a collection], you’re probably doing it wrong.</p>
</blockquote>

<h2 id="looping-over-two-collections">Looping over two collections</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">raymond</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">rachel</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">matthew</span><span class="sh">'</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">green</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">yellow</span><span class="sh">'</span><span class="p">]</span>

<span class="n">n</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">names</span><span class="p">),</span> <span class="nf">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="sh">'</span><span class="s">---&gt;</span><span class="sh">'</span><span class="p">,</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">name</span><span class="p">,</span> <span class="sh">'</span><span class="s">---&gt;</span><span class="sh">'</span><span class="p">,</span> <span class="n">color</span>
</code></pre></div></div>

<h3 id="better-4">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nf">izip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">name</span><span class="p">,</span> <span class="sh">'</span><span class="s">---&gt;</span><span class="sh">'</span><span class="p">,</span> <span class="n">color</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">zip</code> creates a new list in memory and takes more memory. <code class="highlighter-rouge">izip</code> is more efficient than <code class="highlighter-rouge">zip</code>.
Note: in python 3 <code class="highlighter-rouge">izip</code> was renamed to <code class="highlighter-rouge">zip</code> and promoted to a builtin replacing the old <code class="highlighter-rouge">zip</code>.</p>

<h2 id="looping-in-sorted-order">Looping in sorted order</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">green</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">yellow</span><span class="sh">'</span><span class="p">]</span>

<span class="c1"># Forward sorted order
</span><span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">colors</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">colors</span>

<span class="c1"># Backwards sorted order
</span><span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">colors</span>
</code></pre></div></div>

<h2 id="custom-sort-order">Custom Sort Order</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">green</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">yellow</span><span class="sh">'</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">compare_length</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">c2</span><span class="p">):</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">c2</span><span class="p">):</span> <span class="k">return</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="mi">0</span>

<span class="k">print</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="nb">cmp</span><span class="o">=</span><span class="n">compare_length</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="better-5">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>
</code></pre></div></div>

<p>The original is slow and unpleasant to write. Also, comparison functions are no longer available in python 3.</p>

<h2 id="call-a-function-until-a-sentinel-value">Call a function until a sentinel value</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">blocks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">block</span> <span class="o">==</span> <span class="sh">''</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">blocks</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="better-6">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">blocks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="nf">iter</span><span class="p">(</span><span class="nf">partial</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="sh">''</span><span class="p">):</span>
    <span class="n">blocks</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">iter</code> takes two arguments. The first you call over and over again and the second is a sentinel value.</p>

<h2 id="distinguishing-multiple-exit-points-in-loops">Distinguishing multiple exit points in loops</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="n">found</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="n">target</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">i</span>
</code></pre></div></div>

<h3 id="better-7">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="n">target</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">i</span>
</code></pre></div></div>

<p>Inside of every <code class="highlighter-rouge">for</code> loop is an <code class="highlighter-rouge">else</code>.</p>

<h2 id="looping-over-dictionary-keys">Looping over dictionary keys</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">matthew</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">rachel</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">green</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">raymond</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">}</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">k</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">.</span><span class="nf">keys</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">k</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">):</span>
        <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</code></pre></div></div>

<p>When should you use the second and not the first? When you’re mutating the dictionary.</p>

<blockquote>
  <p>If you mutate something while you’re iterating over it, you’re living in a state of sin and deserve what ever happens to you.</p>
</blockquote>

<p><code class="highlighter-rouge">d.keys()</code> makes a copy of all the keys and stores them in a list. Then you can modify the dictionary.
Note: in python 3 to iterate through a dictionary you have to explicitly write: <code class="highlighter-rouge">list(d.keys())</code> because <code class="highlighter-rouge">d.keys()</code> returns a “dictionary view” (an iterable that provide a dynamic view on the dictionary’s keys). See <a href="https://docs.python.org/3/library/stdtypes.html#dict-views">documentation</a>.</p>

<h2 id="looping-over-dictionary-keys-and-values">Looping over dictionary keys and values</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Not very fast, has to re-hash every key and do a lookup
</span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">k</span><span class="p">,</span> <span class="sh">'</span><span class="s">---&gt;</span><span class="sh">'</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

<span class="c1"># Makes a big huge list
</span><span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">k</span><span class="p">,</span> <span class="sh">'</span><span class="s">---&gt;</span><span class="sh">'</span><span class="p">,</span> <span class="n">v</span>
</code></pre></div></div>

<h3 id="better-8">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="p">.</span><span class="nf">iteritems</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">k</span><span class="p">,</span> <span class="sh">'</span><span class="s">---&gt;</span><span class="sh">'</span><span class="p">,</span> <span class="n">v</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">iteritems()</code> is better as it returns an iterator.
Note: in python 3 there is no <code class="highlighter-rouge">iteritems()</code> and <code class="highlighter-rouge">items()</code> behaviour is close to what <code class="highlighter-rouge">iteritems()</code> had. See <a href="https://docs.python.org/3/library/stdtypes.html#dict-views">documentation</a>.</p>

<h2 id="construct-a-dictionary-from-pairs">Construct a dictionary from pairs</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">raymond</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">rachel</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">matthew</span><span class="sh">'</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">green</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">]</span>

<span class="n">d</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">(</span><span class="nf">izip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">colors</span><span class="p">))</span>
<span class="c1"># {'matthew': 'blue', 'rachel': 'green', 'raymond': 'red'}
</span></code></pre></div></div>
<p>For python 3: <code class="highlighter-rouge">d = dict(zip(names, colors))</code></p>

<h2 id="counting-with-dictionaries">Counting with dictionaries</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">green</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">green</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">]</span>

<span class="c1"># Simple, basic way to count. A good start for beginners.
</span><span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">color</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
        <span class="n">d</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">d</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c1"># {'blue': 1, 'green': 2, 'red': 3}
</span></code></pre></div></div>

<h3 id="better-9">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">:</span>
    <span class="n">d</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c1"># Slightly more modern but has several caveats, better for advanced users
# who understand the intricacies
</span><span class="n">d</span> <span class="o">=</span> <span class="n">collections</span><span class="p">.</span><span class="nf">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">:</span>
    <span class="n">d</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></div>

<h2 id="grouping-with-dictionaries--part-i-and-ii">Grouping with dictionaries – Part I and II</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">raymond</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">rachel</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">matthew</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">roger</span><span class="sh">'</span><span class="p">,</span>
         <span class="sh">'</span><span class="s">betty</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">melissa</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">judith</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">charlie</span><span class="sh">'</span><span class="p">]</span>

<span class="c1"># In this example, we're grouping by name length
</span><span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
    <span class="n">key</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
        <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="c1"># {5: ['roger', 'betty'], 6: ['rachel', 'judith'], 7: ['raymond', 'matthew', 'melissa', 'charlie']}
</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
    <span class="n">key</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">d</span><span class="p">.</span><span class="nf">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[]).</span><span class="nf">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="better-10">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="n">collections</span><span class="p">.</span><span class="nf">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
    <span class="n">key</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="is-a-dictionary-popitem-atomic">Is a dictionary popitem() atomic?</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">matthew</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">rachel</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">green</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">raymond</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">}</span>

<span class="k">while</span> <span class="n">d</span><span class="p">:</span>
    <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">d</span><span class="p">.</span><span class="nf">popitem</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">key</span><span class="p">,</span> <span class="sh">'</span><span class="s">--&gt;</span><span class="sh">'</span><span class="p">,</span> <span class="n">value</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">popitem</code> is atomic so you don’t have to put locks around it to use it in threads.</p>

<h2 id="linking-dictionaries">Linking dictionaries</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">color</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">guest</span><span class="sh">'</span><span class="p">}</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="nc">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">-u</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">--user</span><span class="sh">'</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">-c</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">--color</span><span class="sh">'</span><span class="p">)</span>
<span class="n">namespace</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="nf">parse_args</span><span class="p">([])</span>
<span class="n">command_line_args</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nf">vars</span><span class="p">(</span><span class="n">namespace</span><span class="p">).</span><span class="nf">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">}</span>

<span class="c1"># The common approach below allows you to use defaults at first, then override them
# with environment variables and then finally override them with command line arguments.
# It copies data like crazy, unfortunately.
</span><span class="n">d</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
<span class="n">d</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">)</span>
<span class="n">d</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">command_line_args</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="better-11">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="nc">ChainMap</span><span class="p">(</span><span class="n">command_line_args</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">,</span> <span class="n">defaults</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">ChainMap</code> has been introduced into python 3. Fast and beautiful.</p>

<h2 id="improving-clarity">Improving Clarity</h2>
<ul>
  <li>Positional arguments and indicies are nice</li>
  <li>Keywords and names are better</li>
  <li>The first way is convenient for the computer</li>
  <li>The second corresponds to how human’s think</li>
</ul>

<h2 id="clarify-function-calls-with-keyword-arguments">Clarify function calls with keyword arguments</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">twitter_search</span><span class="p">(</span><span class="sh">'</span><span class="s">@obama</span><span class="sh">'</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="better-12">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">twitter_search</span><span class="p">(</span><span class="sh">'</span><span class="s">@obama</span><span class="sh">'</span><span class="p">,</span> <span class="n">retweets</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">numtweets</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">popular</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p>Is slightly (microseconds) slower but is worth it for the code clarity and developer time savings.</p>

<h2 id="clarify-multiple-return-values-with-named-tuples">Clarify multiple return values with named tuples</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Old testmod return value
</span><span class="n">doctest</span><span class="p">.</span><span class="nf">testmod</span><span class="p">()</span>
<span class="c1"># (0, 4)
# Is this good or bad? You don't know because it's not clear.
</span></code></pre></div></div>

<h3 id="better-13">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># New testmod return value, a namedTuple
</span><span class="n">doctest</span><span class="p">.</span><span class="nf">testmod</span><span class="p">()</span>
<span class="c1"># TestResults(failed=0, attempted=4)
</span></code></pre></div></div>

<p>A namedTuple is a subclass of tuple so they still work like a regular tuple, but are more friendly.</p>

<p>To make a namedTuple:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">TestResults</span> <span class="o">=</span> <span class="nf">namedTuple</span><span class="p">(</span><span class="sh">'</span><span class="s">TestResults</span><span class="sh">'</span><span class="p">,</span> <span class="p">[</span><span class="sh">'</span><span class="s">failed</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">attempted</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div>

<h2 id="unpacking-sequences">Unpacking sequences</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Raymond</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Hettinger</span><span class="sh">'</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="sh">'</span><span class="s">python@example.com</span><span class="sh">'</span>

<span class="c1"># A common approach / habit from other languages
</span><span class="n">fname</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lname</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">age</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">email</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="better-14">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fname</span><span class="p">,</span> <span class="n">lname</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">email</span> <span class="o">=</span> <span class="n">p</span>
</code></pre></div></div>

<p>The second approach uses tuple unpacking and is faster and more readable.</p>

<h2 id="updating-multiple-state-variables">Updating multiple state variables</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">x</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">t</span>
</code></pre></div></div>

<h3 id="better-15">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">x</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</code></pre></div></div>

<p>Problems with first approach</p>

<ul>
  <li>x and y are state, and state should be updated all at once or in between lines that state is mis-matched and a common source of issues</li>
  <li>ordering matters</li>
  <li>it’s too low level</li>
</ul>

<p>The second approach is more high-level, doesn’t risk getting the order wrong and is fast.</p>

<h2 id="simultaneous-state-updates">Simultaneous state updates</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tmp_x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">t</span>
<span class="n">tmp_y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">t</span>
<span class="c1"># NOTE: The "influence" function here is just an example function, what it does
# is not important. The important part is how to manage updating multiple
# variables at once.
</span><span class="n">tmp_dx</span> <span class="o">=</span> <span class="nf">influence</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">partial</span><span class="o">=</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">)</span>
<span class="n">tmp_dy</span> <span class="o">=</span> <span class="nf">influence</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">partial</span><span class="o">=</span><span class="sh">'</span><span class="s">y</span><span class="sh">'</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">tmp_x</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">tmp_y</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">tmp_dx</span>
<span class="n">dy</span> <span class="o">=</span> <span class="n">tmp_dy</span>
</code></pre></div></div>

<h3 id="better-16">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># NOTE: The "influence" function here is just an example function, what it does
# is not important. The important part is how to manage updating multiple
# variables at once.
</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
                <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
                <span class="nf">influence</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">partial</span><span class="o">=</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">),</span>
                <span class="nf">influence</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">partial</span><span class="o">=</span><span class="sh">'</span><span class="s">y</span><span class="sh">'</span><span class="p">))</span>
</code></pre></div></div>

<h2 id="efficiency">Efficiency</h2>
<ul>
  <li>An optimization fundamental rule</li>
  <li>Don’t cause data to move around unnecessarily</li>
  <li>It takes only a little care to avoid O(n**2) behavior instead of linear behavior</li>
</ul>

<blockquote>
  <p>Basically, just don’t move data around unecessarily.</p>
</blockquote>

<h2 id="concatenating-strings">Concatenating strings</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">raymond</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">rachel</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">matthew</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">roger</span><span class="sh">'</span><span class="p">,</span>
         <span class="sh">'</span><span class="s">betty</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">melissa</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">judith</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">charlie</span><span class="sh">'</span><span class="p">]</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="sh">'</span><span class="s">, </span><span class="sh">'</span> <span class="o">+</span> <span class="n">name</span>
<span class="k">print</span> <span class="n">s</span>
</code></pre></div></div>

<h3 id="better-17">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span> <span class="sh">'</span><span class="s">, </span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="updating-sequences">Updating sequences</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">raymond</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">rachel</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">matthew</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">roger</span><span class="sh">'</span><span class="p">,</span>
         <span class="sh">'</span><span class="s">betty</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">melissa</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">judith</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">charlie</span><span class="sh">'</span><span class="p">]</span>

<span class="k">del</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># The below are signs you're using the wrong data structure
</span><span class="n">names</span><span class="p">.</span><span class="nf">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">names</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="sh">'</span><span class="s">mark</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="better-18">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">names</span> <span class="o">=</span> <span class="n">collections</span><span class="p">.</span><span class="nf">deque</span><span class="p">([</span><span class="sh">'</span><span class="s">raymond</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">rachel</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">matthew</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">roger</span><span class="sh">'</span><span class="p">,</span>
               <span class="sh">'</span><span class="s">betty</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">melissa</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">judith</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">charlie</span><span class="sh">'</span><span class="p">])</span>

<span class="c1"># More efficient with collections.deque
</span><span class="k">del</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">names</span><span class="p">.</span><span class="nf">popleft</span><span class="p">()</span>
<span class="n">names</span><span class="p">.</span><span class="nf">appendleft</span><span class="p">(</span><span class="sh">'</span><span class="s">mark</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>
<h2 id="decorators-and-context-managers">Decorators and Context Managers</h2>
<ul>
  <li>Helps separate business logic from administrative logic</li>
  <li>Clean, beautiful tools for factoring code and improving code reuse</li>
  <li>Good naming is essential.</li>
  <li>Remember the Spiderman rule: With great power, comes great responsibility!</li>
</ul>

<h2 id="using-decorators-to-factor-out-administrative-logic">Using decorators to factor-out administrative logic</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Mixes business / administrative logic and is not reusable
</span><span class="k">def</span> <span class="nf">web_lookup</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">saved</span><span class="o">=</span><span class="p">{}):</span>
    <span class="k">if</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">saved</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">saved</span><span class="p">[</span><span class="n">url</span><span class="p">]</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="nf">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span>
    <span class="n">saved</span><span class="p">[</span><span class="n">url</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
    <span class="k">return</span> <span class="n">page</span>
</code></pre></div></div>

<h3 id="better-19">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@cache</span>
<span class="k">def</span> <span class="nf">web_lookup</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">urllib</span><span class="p">.</span><span class="nf">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span>
</code></pre></div></div>

<p>Note: since python 3.2 there is a decorator for this in the standard library: <code class="highlighter-rouge">functools.lru_cache</code>.</p>

<h2 id="factor-out-temporary-contexts">Factor-out temporary contexts</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Saving the old, restoring the new
</span><span class="n">old_context</span> <span class="o">=</span> <span class="nf">getcontext</span><span class="p">().</span><span class="nf">copy</span><span class="p">()</span>
<span class="nf">getcontext</span><span class="p">().</span><span class="n">prec</span> <span class="o">=</span> <span class="mi">50</span>
<span class="k">print</span> <span class="nc">Decimal</span><span class="p">(</span><span class="mi">355</span><span class="p">)</span> <span class="o">/</span> <span class="nc">Decimal</span><span class="p">(</span><span class="mi">113</span><span class="p">)</span>
<span class="nf">setcontext</span><span class="p">(</span><span class="n">old_context</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="better-20">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nf">localcontext</span><span class="p">(</span><span class="nc">Context</span><span class="p">(</span><span class="n">prec</span><span class="o">=</span><span class="mi">50</span><span class="p">)):</span>
    <span class="k">print</span> <span class="nc">Decimal</span><span class="p">(</span><span class="mi">355</span><span class="p">)</span> <span class="o">/</span> <span class="nc">Decimal</span><span class="p">(</span><span class="mi">113</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="how-to-open-and-close-files">How to open and close files</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">data.txt</span><span class="sh">'</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">f</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="better-21">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">data.txt</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="how-to-use-locks">How to use locks</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Make a lock
</span><span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Lock</span><span class="p">()</span>

<span class="c1"># Old-way to use a lock
</span><span class="n">lock</span><span class="p">.</span><span class="nf">acquire</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">print</span> <span class="sh">'</span><span class="s">Critical section 1</span><span class="sh">'</span>
    <span class="k">print</span> <span class="sh">'</span><span class="s">Critical section 2</span><span class="sh">'</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">lock</span><span class="p">.</span><span class="nf">release</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="better-22">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># New-way to use a lock
</span><span class="k">with</span> <span class="n">lock</span><span class="p">:</span>
    <span class="k">print</span> <span class="sh">'</span><span class="s">Critical section 1</span><span class="sh">'</span>
    <span class="k">print</span> <span class="sh">'</span><span class="s">Critical section 2</span><span class="sh">'</span>
</code></pre></div></div>

<h2 id="factor-out-temporary-contexts-1">Factor-out temporary contexts</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">remove</span><span class="p">(</span><span class="sh">'</span><span class="s">somefile.tmp</span><span class="sh">'</span><span class="p">)</span>
<span class="k">except</span> <span class="nb">OSError</span><span class="p">:</span>
    <span class="k">pass</span>
</code></pre></div></div>

<h3 id="better-23">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nf">ignored</span><span class="p">(</span><span class="nb">OSError</span><span class="p">):</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">remove</span><span class="p">(</span><span class="sh">'</span><span class="s">somefile.tmp</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">ignored</code> is is new in python 3.4, <a href="http://docs.python.org/dev/library/contextlib.html#contextlib.ignored">documentation</a>.
Note: <code class="highlighter-rouge">ignored</code> is actually called <code class="highlighter-rouge">suppress</code> in the standard library.</p>

<p>To make your own <code class="highlighter-rouge">ignored</code> context manager in the meantime:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">ignored</span><span class="p">(</span><span class="o">*</span><span class="n">exceptions</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">except</span> <span class="n">exceptions</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre></div></div>

<blockquote>
  <p>Stick that in your utils directory and you too can ignore exceptions</p>
</blockquote>

<h2 id="factor-out-temporary-contexts-2">Factor-out temporary contexts</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Temporarily redirect standard out to a file and then return it to normal
</span><span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">help.txt</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">oldstdout</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span>
    <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">f</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nf">help</span><span class="p">(</span><span class="nb">pow</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">oldstdout</span>
</code></pre></div></div>

<h3 id="better-24">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">help.txt</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">with</span> <span class="nf">redirect_stdout</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="nf">help</span><span class="p">(</span><span class="nb">pow</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">redirect_stdout</code> is proposed for python 3.4, <a href="http://bugs.python.org/issue15805">bug report</a>.</p>

<p>To roll your own <code class="highlighter-rouge">redirect_stdout</code> context manager</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">redirect_stdout</span><span class="p">(</span><span class="n">fileobj</span><span class="p">):</span>
    <span class="n">oldstdout</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span>
    <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">fileobj</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">fileobj</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">oldstdout</span>
</code></pre></div></div>

<h2 id="concise-expressive-one-liners">Concise Expressive One-Liners</h2>
<p>Two conflicting rules:</p>

<ul>
  <li>Don’t put too much on one line</li>
  <li>Don’t break atoms of thought into subatomic particles</li>
</ul>

<p>Raymond’s rule:</p>

<ul>
  <li>One logical line of code equals one sentence in English</li>
</ul>

<h2 id="list-comprehensions-and-generator-expressions">List Comprehensions and Generator Expressions</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">i</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">result</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">print</span> <span class="nf">sum</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="better-25">Better</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span> <span class="nf">sum</span><span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">xrange</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</code></pre></div></div>

<p>First way tells you what to do, second way tells you what you want.</p>


<hr />

<a href="/2017/command-line-arguments/" style="text-decoration:none;">⬅️ Read previous</a>

<a href="/2017/exceptions-in-ruby/" style="float: right; text-decoration:none;">Read next ➡️</a>

    </main>

    <footer>
  <p style="text-align:center"><strong>
    <a href="/feed.xml">Feed</a>
  </strong></p>

  <hr />

  <h6>Imprint</h6>
  <p>
    <strong>Simon Neutert</strong><br />
    <span id="imprint-address">
      Postfach 1120, 55258 Ingelheim
    </span>
  </p>
  <p style="text-align:center"><strong>
    Generated using <a href="https://www.bridgetownrb.com">Bridgetown</a>
  </strong></p>
</footer>

  </body>
</html>
