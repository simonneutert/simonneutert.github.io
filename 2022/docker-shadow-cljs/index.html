<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />


<title>Dockering a shadow-cljs app | Simon Neutert</title>

<meta name="description" content="I am a Ruby (on Rails) developer and open source enthusiast. Super interest in Clojure. Based in Ingelheim, next to Mainz and Wiesbaden (Rhein-Main)." />

<link rel="stylesheet" href="/_bridgetown/static/index.IEH6LJYO.css" data-turbo-track="reload" />

<script src="/_bridgetown/static/index.Q4PHQU7R.js" data-turbo-track="reload" defer></script>


    <link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Simon Neutert" />
  </head>
  <body class="post ">
    <header>
  <!-- 
  <img src="/images/logo.svg" alt="Logo" />
  -->
</header>

<nav>
  <ul>
    <li><a href="/">Home</a></li>
    <!-- <li><a href="/telegram">On Telegram</a></li> -->
    <!-- <li><a href="/about">About</a></li> -->
    <li><a href="/posts">Blog</a></li>
  </ul>
</nav>


    <main>
      <a href="/posts" style="text-decoration:none; text-align=center;">↖️ Show all posts</a>

<hr />

<h1>Dockering a shadow-cljs app</h1>

<p>I&#8217;d say there are two ways of doing it, either install Java or install Node.</p>

<p>I prefer installing Java and Clojure.</p>

<p>Here&#8217;s a very minimal two staged example:</p>

<div class="language-Dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="w"> </span><span class="s">node:16-buster</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">build</span>

<span class="k">RUN </span>apt-get update <span class="o">&amp;&amp;</span> apt-get <span class="nt">-q</span> <span class="nt">-y</span> <span class="nb">install</span> <span class="se">\
</span>    openjdk-11-jre-headless <span class="se">\
</span>    curl

<span class="k">RUN </span>curl <span class="nt">-s</span> https://download.clojure.org/install/linux-install-1.11.1.1165.sh | bash <span class="se">\
</span>    <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/apt/lists/<span class="k">*</span>

<span class="k">RUN </span>npm i <span class="nt">-g</span> shadow-cljs

<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> shadow-cljs.edn /app/</span>
<span class="k">COPY</span><span class="s"> src /app/src</span>
<span class="k">COPY</span><span class="s"> public/index.html /app/public/index.html</span>

<span class="k">RUN </span>npx shadow-cljs release frontend

<span class="k">FROM</span><span class="s"> nginx:1-alpine</span>

<span class="k">COPY</span><span class="s"> --from=build /app/public/index.html /usr/share/nginx/html/index.html</span>
<span class="k">COPY</span><span class="s"> --from=build /app/public/js/main.js /usr/share/nginx/html/js/main.js</span>
</code></pre></div></div>

<p>Make sure you have your release pipeline ready to roll!</p>

<p>From the shadow-cljs <a href="https://shadow-cljs.github.io/docs/UsersGuide.html#release">documentation</a>:</p>

<p>Adjust your <code class="highlighter-rouge">shadow-cljs.edn</code> to your taste.</p>

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">;; shadow-cljs configuration</span><span class="w">
</span><span class="p">{</span><span class="no">:source-paths</span><span class="w">
 </span><span class="p">[</span><span class="s">"src/dev"</span><span class="w">
  </span><span class="s">"src/main"</span><span class="w">
  </span><span class="s">"src/test"</span><span class="p">]</span><span class="w">

 </span><span class="no">:dependencies</span><span class="w"> </span><span class="p">[[</span><span class="n">hiccups/hiccups</span><span class="w"> </span><span class="s">"0.3.0"</span><span class="p">]]</span><span class="w">
 </span><span class="no">:dev-http</span><span class="w"> </span><span class="p">{</span><span class="mi">8080</span><span class="w"> </span><span class="s">"public"</span><span class="p">}</span><span class="w">
 </span><span class="no">:builds</span><span class="w"> </span><span class="p">{</span><span class="no">:frontend</span><span class="w">
          </span><span class="p">{</span><span class="no">:target</span><span class="w"> </span><span class="no">:browser</span><span class="w">
           </span><span class="no">:modules</span><span class="w"> </span><span class="p">{</span><span class="no">:main</span><span class="w"> </span><span class="p">{</span><span class="no">:init-fn</span><span class="w"> </span><span class="n">app.core/init</span><span class="p">}}</span><span class="w"> </span><span class="c1">;; adjust here</span><span class="w">
           </span><span class="no">:release</span><span class="w"> </span><span class="p">{</span><span class="no">:compiler-options</span><span class="w"> </span><span class="p">{</span><span class="no">:optimizations</span><span class="w"> </span><span class="no">:advanced</span><span class="p">}}}</span><span class="w">
          </span><span class="no">:test</span><span class="w">
          </span><span class="p">{</span><span class="no">:target</span><span class="w">    </span><span class="no">:node-test</span><span class="w">
           </span><span class="no">:output-to</span><span class="w"> </span><span class="s">"out/node-tests.js"</span><span class="w">
           </span><span class="no">:ns-regexp</span><span class="w"> </span><span class="s">"-test$"</span><span class="w">
           </span><span class="no">:autorun</span><span class="w">   </span><span class="n">true</span><span class="p">}}}</span><span class="w">
</span></code></pre></div></div>

<p>For more inspiration checkout my demo project on GitHub <a href="https://github.com/simonneutert/pizza-dough-calculator">pizza-dough-calculator</a>.</p>


<hr />

<a id="btn-previous" href="/2022/pizza-dough-shadow-cljs/" style="text-decoration:none;">⬅️ Read previous</a>

<a id="btn-next" href="/2022/engineering-manager/" style="float: right; text-decoration:none;">Read next ➡️</a>

    </main>

    <footer>
  <p style="text-align:center"><strong>
    <a href="/feed.xml">Feed</a>
  </strong></p>

  <hr />

  <h6>Imprint</h6>
  <p>
    <strong>Simon Neutert</strong><br />
    <span id="imprint-address">
      Postfach 1120, 55258 Ingelheim
    </span>
  </p>
  <p style="text-align:center"><strong>
    Generated using <a href="https://www.bridgetownrb.com">Bridgetown</a>
  </strong></p>
</footer>

  </body>
</html>
